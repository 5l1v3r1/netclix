#!/usr/bin/env node
'use strict';require('babel-polyfill');var _phantom=require('phantom');var _phantom2=_interopRequireDefault(_phantom);var _ora=require('ora');var _ora2=_interopRequireDefault(_ora);var _debug=require('debug');var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{return Promise.resolve(value).then(function(value){step("next",value);},function(err){step("throw",err);});}}return step("next");});};}var log=(0,_debug2.default)('all');var id=process.argv[2];if(!id){console.error('Usage: netclix [IMDB ID]');process.exit(0);}_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var attempt,spinner,renderPage,url,embed,link;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:attempt=0;spinner=(0,_ora2.default)('Searching streaming link').start();renderPage=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(url){var instance,page,embed;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(attempt===5){spinner.fail('No link');spinner.stop();process.exit(0);}_context.next=3;return _phantom2.default.create();case 3:instance=_context.sent;_context.next=6;return instance.createPage();case 6:page=_context.sent;_context.next=9;return page.open(url);case 9:_context.next=11;return page.evaluate(function(){if(document.getElementById('player_frame')){return document.getElementById('player_frame').innerHTML.replace(/&quot;/g,'"');}return null;});case 11:embed=_context.sent;if(embed){_context.next=20;break;}attempt+=1;log('Attempt '+attempt);_context.next=17;return instance.exit();case 17:_context.next=19;return renderPage(url);case 19:return _context.abrupt('return',_context.sent);case 20:_context.next=22;return instance.exit();case 22:return _context.abrupt('return',embed);case 23:case'end':return _context.stop();}}},_callee,undefined);}));return function renderPage(_x){return _ref2.apply(this,arguments);};}();url='http://vodlocker.to/embed?i='+id;_context2.next=6;return renderPage(url);case 6:embed=_context2.sent;link=embed.match(/(((http[s]?|ftp):\/)?\/?([^:/\s]+)((\/\w+)*\/)([\w\-.]+[^#?\s]+)(.*)?(#[\w-]+)?)",/)[1];if(link){spinner.succeed('Your streaming link is here: '+link);}else{spinner.fail('No link');}spinner.stop();case 10:case'end':return _context2.stop();}}},_callee2,undefined);}))();